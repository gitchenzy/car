<extend name="Public/common" />
<block name="body">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5><empty name="Think.get.id">新增<else /> 编辑</empty>合同信息</h5>
                </div>
                <div class="ibox-content">
    <form class="form-horizontal" role="form" id="defaultForm" method="post" action="{$self}">
        <input type="hidden" name="id" value="{$info.ContractID}" />
        <fieldset>
            <div class="form-group">
                <label class="col-sm-2 control-label"><span style="color: red;">*</span>&nbsp;客户简称</label>
                <div class="col-sm-3" style="position:relative;z-index:999;">
                    <!--{:parse_dropdownlist($info[Identifier],$cInfo,"Identifier","Identifier","form-control","请选择客户")}-->
                    <input class="form-control" id="Identifier" name="ShortName"  value="{$info.ShortName}" type="text" />
                    <div id="boxTxt" class="col-sm-10" style="display: none;position:absolute;background: #fff;border:1px solid #00b7ee;height:150px;overflow: scroll;">
                        <ul id="bodys">

                        </ul>
                    </div>
                </div>
                <label class="col-sm-2 control-label" ><span style="color: red;">*</span>&nbsp;购买产品</label>
                <div class="col-sm-3">
                    <volist name="product" id="pro">
                        <input name="productID[]" {$pro.checked} type="checkbox" value="{$pro.ProductID}">{$pro.ProductName}
                    </volist>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label" >合同类型</label>
                <div class="col-sm-3">
                    {:parse_dropdownlist($info[CttTypeID],$ttInfo,"CttTypeID","CttTypeID","form-control","请选择合同类型")}
                </div>
                <label class="col-sm-2 control-label" >支付方式</label>
                <div class="col-sm-3">
                    {:parse_dropdownlist($info[PayTypeID],$pay,"PayTypeID","PayTypeID","form-control","请选择支付方式")}
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label" for="CttNumber">合同编号</label>
                <div class="col-sm-3">
                    <input class="form-control" id="CttNumber" type="text" name="CttNumber" value="{$info.CttNumber}"/>
                </div>
                <label class="col-sm-2 control-label" for="Amount"><span style="color: red;">*</span>&nbsp;总金额</label>
                <div class="col-sm-3">
                    <input class="form-control" id="Amount" type="text" name="Amount" value="{$info.Amount}"/>
                </div>

            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label" for="CtmPrincipal"><span style="color: red;">*</span>&nbsp;对方负责人</label>
                <div class="col-sm-3">
                    <input class="form-control" id="CtmPrincipal" name="CtmPrincipal"  value="{$info.CtmPrincipal}" type="text" />
                </div>
                <label class="col-sm-2 control-label" for="OwnPrincipal">我方负责人</label>
                <div class="col-sm-3">
                    <input class="form-control" id="OwnPrincipal" name="OwnPrincipal"  value="{$info.OwnPrincipal}" type="text" />
                </div>

            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label" for="CtmSign">系统对接人</label>
                <div class="col-sm-3">
                    <input class="form-control" id="CtmSign" name="CtmSign"  value="{$info.CtmSign}" type="text" />
                </div>
                <label class="col-sm-2 control-label" for="OwnSign">我方签约人</label>
                <div class="col-sm-3">
                    <input class="form-control" id="OwnSign" name="OwnSign"  value="{$info.OwnSign}" type="text" />
                </div>

            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label" for="Charge"><span style="color: red;">*</span>&nbsp;维护费用</label>
                <div class="col-sm-3">
                    <input class="form-control" id="Charge" name="Charge"  value="{$info.Charge}" type="text" />
                </div>
                <label class="col-sm-2 control-label" for="SignTime"><span style="color: red;">*</span>&nbsp;签约时间</label>
                <div class="col-sm-3">
                    <input class="form-control" id="SignTime" name="SignTime"  value="{$info.SignTime}" type="text" />
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label" for="BeginTime"><span style="color: red;">*</span>&nbsp;生效时间</label>
                <div class="col-sm-3">
                    <input class="form-control" id="BeginTime" name="BeginTime"  value="{$info.BeginTime}" type="text" />
                </div>
                <label class="col-sm-2 control-label" for="FinishTime"><span style="color: red;">*</span>&nbsp;结束时间</label>
                <div class="col-sm-3">
                    <input class="form-control" id="FinishTime" name="FinishTime"  value="{$info.FinishTime}" type="text" />
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label" for="Address"><span style="color: red;">*</span>&nbsp;客户地址</label>
                <div class="col-sm-3">
                    <input class="form-control" id="Address" name="Address"  value="{$info.Address}" type="text" />
                </div>
                <label class="col-sm-2 control-label" for="Telephone"><span style="color: red;">*</span>&nbsp;联系电话</label>
                <div class="col-sm-3">
                    <input class="form-control" id="Telephone" name="Telephone"  value="{$info.Telephone}" type="text" />
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label"><span style="color: red;">*</span>&nbsp;收款时间</label>
                <div class="col-sm-3">
                    <input class="form-control" id="PlanTime" name="PlanTime"  value="{$info.PlanTime}" type="text" />
                </div>
                <label class="col-sm-2 control-label" for="SiteAddress"><span style="color: red;">*</span>&nbsp;域号</label>
                <div class="col-sm-2">
                    <input class="" id="SiteAddress" style="display: inline-block;" name="SiteAddress"  value="{$info.SiteAddress}" type="text" />.goooy.cn
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">收款备注</label>
                <div class="col-sm-3">
                    <input class="form-control" id="PlanContent" name="PlanContent"  value="{$info.PlanContent}" type="text" />
                </div>
                <label class="col-sm-2 control-label" for="ScanID">合同扫描件</label>
                <div class="col-sm-3">
                    <input type="hidden" id="ScanID" name="ScanName" value="{$info.ScanName}" />
                    <img src="{$info.ScanName|default='__PUBLIC__/no_photo.png'}"  id="photo_preview"  style="height:60px"/>
                    <div style="padding: 5px 0 0 0;">
                        <a href="javascript:void(0)" class="btn btn-default" id="btn-upload" data-options="iconCls:'icon-upload'">上传</a>
                    </div>
                </div>
            </div>
            <div class="form-group">

            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label" for="Introduce">合同说明</label>
                <div class="col-sm-8">
                    <!--
                    <input class="form-control" id="Introduce" name="Introduce"  value="{$info.Introduce}" type="text" />
                     <div class="summernote" id="Introduce" name="Introduce">合同说明的内容</div>
                    -->
                    <textarea id="Introduce" name="Introduce" style="width: 99.9%; height: 360px;">{$info.Introduce|htmlspecialchars_decode}</textarea>

                </div>
            </div>

        </fieldset>
        <div class="form-group">
            <div class="col-sm-4 col-sm-offset-2">
                <button class="btn btn-primary" type="submit" id="submit">保存内容</button>
                <button class="btn btn-white" type="button" id="close">取消</button>
            </div>
        </div>
    </form>
                    </div>
                </div>
            </div>
        </div>
</block>
<block name="script">

    <script type="text/javascript" src='__PUBLIC__/Static/Ueditor23578/ueditor.config.js'></script>
    <script type="text/javascript" src='__PUBLIC__/Static/Ueditor23578/ueditor.all.min.js'></script>
    <script type="text/javascript">
        getcustomer();
        var ue = UE.getEditor('Introduce');

        $(document).ready(function() {
            loadSomething();
            $('#defaultForm')
                    .bootstrapValidator({
                        message: 'This value is not valid',
                        feedbackIcons: {
                            valid: 'glyphicon glyphicon-ok',
                            invalid: 'glyphicon glyphicon-remove',
                            validating: 'glyphicon glyphicon-refresh'
                        },
                        fields: {
                            LoginName: {
                                message: '账号不可用',
                                validators: {
                                    notEmpty: {
                                        message: '账号不能为空'
                                    },
                                    stringLength: {
                                        min: 6,
                                        max: 30,
                                        message: '账号长度6-30'
                                    },
                                    /*remote: {
                                     url: 'remote.php',
                                     message: '账号不可用'
                                     },*/
                                    regexp: {
                                        regexp: /^[a-zA-Z0-9_\.]+$/,
                                        message: '账号格式不正确'
                                    }
                                }
                            }
                        }
                    })
                    .on('success.form.bv', function(e) {
                        // Prevent form submission
                        e.preventDefault();
                        // Get the form instance
                        var $form = $(e.target);
                        // Get the BootstrapValidator instance
                        var bv = $form.data('bootstrapValidator');
                        // Use Ajax to submit form data
                        $.post($form.attr('action'), $form.serialize(), function(result) {
                            if(result.status==1){
                                swal({
                                    title:"操作成功！",
                                    text:result.info,
                                    type:"success"
                                },function(){
                                    location.href = result.url
                                    //$('#defaultForm').bootstrapValidator('resetForm', true);$('input').val('');$('#addCustomer').modal('hide');
                                });
                            }else{
                                toastr.warning(result.info);return false;
                            }
                        }, 'json');
                    });
        });
        function loadSomething(){
            //设置图片上传插件
            $("#btn-upload").uploadify({
                height: 25,
                swf: '/public/Static/uploadify/uploadify.swf',
                uploader: "{:U('File/uploadPicture',array('session_id'=>session_id()))}",
                width: 80,
                buttonClass: "btn-default",
                buttonText: $("#btn-upload").text(),
                onUploadSuccess: function (file, data, response) {
                    data = $.parseJSON(data);
                    if (data.status) {
                        $("#photo_preview").attr("src", data.data);
                        $("#ScanID").val(data.data);
                    }
                    else {
                        show_alert(data.info);
                    }
                }
            });

            $('.summernote').summernote({
                lang:"zh-CN",
                height: "150px",   //set editable area's height
            });

            laydate({elem: '#SignTime', format: 'YYYY-MM-DD hh:mm:ss',event: 'focus'});
            laydate({elem: '#FinishTime', format: 'YYYY-MM-DD hh:mm:ss', event: 'focus'});
            laydate({elem: '#BeginTime', format: 'YYYY-MM-DD hh:mm:ss', event: 'focus'});
            laydate({elem: '#PlanTime', format: 'YYYY-MM-DD hh:mm:ss', event: 'focus'});
        }
        $(document).ready(function(){
            //var customer = ['中国人', 'bear', 'dog', 'drink', 'elephant', 'fruit', 'bear', 'dog', 'drink', 'elephant', 'fruit', 'bear', 'dog', 'drink', 'elephant', 'fruit'];
            $jq("#Identifier").autocomplete('/admin/Common/getALLCustomer',{
                dataType:"json",
                minChars:0,
                max:10,
                parse: function(data) {
                    return $.map(data, function(row) {
                        return {
                            data: row,
                            value: row,
                            result: row
                        }
                    });
                },
                formatItem: function(item) {
                    return item;
                },
                matchSubset:false
            });
        });
        $('#close').click(function(){

            location.href='/admin/Market/contract'
        })
    </script>
</block>
